<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>회원 가입</title>
  <link rel="canonical" href="https://getbootstrap.kr/docs/5.1/examples/blog/">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
  <link href="/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="/css/style.css" rel="stylesheet"/>
  <script src="/js/jquery-3.7.1.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/popper.min.js"></script>
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/script.js"></script>
</head>
<body>
<header th:replace="~{fragments/header :: header}"></header>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <h2 class="text-center mb-4">회원가입</h2>
        <!--프로그레스바-->
        <div class="progress mb-4">
          <div class="progress-bar" role="progressbar" style="width: 33%;" aria-valuenow="33" aria-valuemin="0"
            aria-valuemax="100">1/3 약관동의</div>
        </div>

        <!--폼 시작-->
        <form action="signup" name="signupForm" id="signupForm" method="post">
          <!--step1 약관동의-->
          <div class="card step" id="step1">
            <div class="card-header">
              <h3 class="card-title">약관 동의</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="allAgree">
                  <label class="custom-control-label" for="allAgree"><strong>모든 약관 동의</strong></label>
                </div>
              </div>
              <hr>
              <div class="form-group">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input agreement-checkbox" id="termsAgree" required>
                  <label class="custom-control-label" for="termsAgree">[필수] 이용약관</label>
                  <button type="button" class="btn btn-link btn-sm" data-toggle="modal" data-target="#termsModal">
                    자세히 보기
                  </button>
                </div>
              </div>
              <div class="form-group">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input agreement-checkbox" id="privacyAgree" required>
                  <label class="custom-control-label" for="privacyAgree">[필수] 개인정보 이용 및 수집에 대한 동의</label>
                  <button type="button" class="btn btn-link btn-sm" data-toggle="modal" data-target="#privacyModal">
                    자세히 보기
                  </button>
                </div>
              </div>
              <div class="form-group">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input agreement-checkbox" id="marketingAgree">
                  <label class="custom-control-label" for="marketingAgree">[선택] 마케팅 및 광고 활용 동의</label>
                  <button type="button" class="btn btn-link btn-sm" data-toggle="modal" data-target="#marketingModal">
                    자세히 보기
                  </button>
                </div>
              </div>
            </div>
            <div class="card-footer text-right">
              <button type="button" class="btn btn-primary" id="nextBtn1">다음</button>
            </div>
          </div>
          <!-- step1 끝-->

          <!-- step2 개인정보입력/가입완료-->
          <div class="card step" id="step2">
            <div class="card-header">
              <h3 class="card-title">개인정보입력</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="userId">아이디(이메일)</label>
                <div class="input-group">
                  <input type="email" class="form-control" name="userId" id="userId"
                    placeholder="ex)ezenbook7@store.com" required>
                  <div class="input-group-append">
                    <button type="button" class="btn btn-primary" id="checkDuplicateBtn">중복검사</button>
                  </div>
                </div>
                <div class="valid-feedback">사용 가능한 아이디입니다.</div>
                <div class="invalid-feedback">올바른 이메일 형식을 입력해주세요.</div>
              </div>
              <div class="form-group">
                <label for="userPw">비밀번호</label>
                <input type="password" class="form-control" name="userPw" id="userPw" placeholder="비밀번호를 입력해주세요."
                  required>
                <div class="invalid-feedback">비밀번호는 8자 이상, 영문, 숫자, 특수문자를 포함해야 합니다.</div>
              </div>
              <div class="form-group">
                <label for="userPwCheck">비밀번호확인</label>
                <input type="password" class="form-control" name="userPwCheck" id="userPwCheck"
                  placeholder="비밀번호를 다시 입력해주세요." required>
                <div class="invalid-feedback">비밀번호가 일치하지 않습니다.</div>
              </div>
              <div class="form-group">
                <label for="userName">이름</label>
                <input type="text" class="form-control" name="userName" id="userName" placeholder="이름을 입력해주세요."
                  required>
              </div>
              <div class="form-group">
                <label for="userBirth">생년월일</label>
                <input type="date" class="form-control" name="userBirth" id="userBirth" required>
              </div>
              <div class="form-group">
                <label for="userTel">전화번호</label>
                <input type="tel" class="form-control" name="userTel" id="userTel"
                  placeholder="번호는 하이폰(-)없이 입력해주세요. ex) 01012341234" required>
                <div class="invalid-feedback">올바른 전화번호 형식을 입력해주세요.</div>
              </div>
              <div class="form-group">
                <label for="userAddress">주소</label>
                <div class="input-group">
                  <input type="text" class="form-control" name="userAddress" id="userAddress" placeholder="주소를 입력해주세요."
                    required>
                  <div class="input-group-append">
                    <button type="button" class="btn btn-secondary">검색</button>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="userDetailAddress">상세주소</label>
                <input type="text" class="form-control" name="userDetailAddress" id="userDetailAddress"
                  placeholder="상세주소를 입력해주세요. ex) 대한민국 아파트 123동 456호">
              </div>
            </div>
            <div class="card-footer text-right">
              <button type="button" class="btn btn-secondary" id="prevBtn2">이전</button>
              <button type="button" class="btn btn-primary" id="nextBtn2">가입완료하기</button>
            </div>
          </div>
          <!-- 개인정보입력/가입완료 끝-->


          <!-- 가입완료확인 -->
          <div class="card step" id="step3">
            <div class="card-body text-center">
              <h4>회원가입이 완료되었습니다!</h4>
              <p>로그인 후 서비스를 이용하실 수 있습니다.</p>
              <div class="text-center">
                <a href="main.html" class="btn btn-success">로그인하기</a>
              </div>
            </div>
          </div>
          <!-- 가입완료확인 끝-->
        </form>
        <!-- 폼 끝 -->
      </div>
    </div>
  </div>
  <!--모달 추가란-->
<div th:replace="~{fragments/signupTermsModal :: signupTermsModal}"></div>
<div th:replace="~{fragments/signupPrivacyModal :: signupPrivacyModal}"></div>
<div th:replace="~{fragments/signupMarketingModal :: signupMarketingModal}"></div>

  <script>
   document.addEventListener("DOMContentLoaded", function () {
  let currentStep = 1;
  const totalSteps = 3;
  const steps = document.querySelectorAll(".step");

  // 모든 약관 동의 체크박스
  const allAgree = document.getElementById("allAgree");
  const agreementCheckboxes = document.querySelectorAll(".agreement-checkbox");

  // 폼 유효성 검사 관련 변수
  const signupForm = document.getElementById("signupForm");

  // 현재 단계 표시 함수
  function showStep(step) {
    steps.forEach((stepElement, index) => {
      if (index + 1 === step) {
        stepElement.classList.add("active");
      } else {
        stepElement.classList.remove("active");
      }
    });

    // 진행 바 업데이트
    const progressBar = document.querySelector(".progress-bar");
    progressBar.style.width = `${(step / totalSteps) * 100}%`;
    progressBar.textContent = `${step}/${totalSteps}`;
  }

  // "다음" 버튼 클릭 시 다음 단계로 이동
  document.getElementById("nextBtn1").addEventListener("click", function () {
    if (validateStep1()) {
      currentStep++;
      showStep(currentStep);
      alert("약관 동의가 완료되었습니다.");
    }
  });

  document.getElementById("nextBtn2").addEventListener("click", function () {
    if (validateStep2()) {
      currentStep++;
      showStep(currentStep);
      alert("회원가입이 완료되었습니다!");
    }
  });

  // "이전" 버튼 클릭 시 이전 단계로 이동
  document.getElementById("prevBtn2").addEventListener("click", function () {
    currentStep--;
    showStep(currentStep);
  });

  // 초기 단계 표시
  showStep(currentStep);

  // "모든 약관 동의" 체크박스를 클릭했을 때
  allAgree.addEventListener("change", function () {
    agreementCheckboxes.forEach(function (checkbox) {
      checkbox.checked = allAgree.checked;
    });
  });

  // 개별 약관 체크박스를 클릭했을 때 "모든 약관 동의" 상태 업데이트
  agreementCheckboxes.forEach(function (checkbox) {
    checkbox.addEventListener("change", function () {
      allAgree.checked = Array.from(agreementCheckboxes).every(function (cb) {
        return cb.checked;
      });
    });
  });

  // Step 1: 약관 동의 유효성 검사
  function validateStep1() {
    let isValid = true;
    let errorMessage = "";

    agreementCheckboxes.forEach(function (checkbox) {
      if (checkbox.required && !checkbox.checked) {
        isValid = false;
        checkbox.classList.add("is-invalid");
        errorMessage += checkbox.nextElementSibling.textContent + " 에 동의해주세요.\n";
      } else {
        checkbox.classList.remove("is-invalid");
      }
    });

    if (!isValid) {
      alert(errorMessage);
    }

    return isValid;
  }

  // Step 2: 개인정보 입력 유효성 검사 실시간 적용
  const emailInput = document.getElementById("userId");
  const passwordInput = document.getElementById("userPw");
  const passwordCheckInput = document.getElementById("userPwCheck");
  const phoneInput = document.getElementById("userTel");

  // 이메일 실시간 유효성 검사
  emailInput.addEventListener('input', function () {
    const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    if (!emailPattern.test(emailInput.value)) {
      emailInput.classList.add("is-invalid");
      emailInput.classList.remove("is-valid");
    } else {
      emailInput.classList.remove("is-invalid");
      emailInput.classList.add("is-valid");
    }
  });

  // 비밀번호 실시간 유효성 검사
  passwordInput.addEventListener('input', function () {
    const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
    if (!passwordPattern.test(passwordInput.value)) {
      passwordInput.classList.add("is-invalid");
      passwordInput.classList.remove("is-valid");
    } else {
      passwordInput.classList.remove("is-invalid");
      passwordInput.classList.add("is-valid");
    }

    // 비밀번호 확인도 함께 실시간으로 검사
    validatePasswordCheck();
  });

  // 비밀번호 확인 실시간 검사
  passwordCheckInput.addEventListener('input', validatePasswordCheck);

  function validatePasswordCheck() {
    if (passwordInput.value !== passwordCheckInput.value) {
      passwordCheckInput.classList.add("is-invalid");
      passwordCheckInput.classList.remove("is-valid");
    } else {
      passwordCheckInput.classList.remove("is-invalid");
      passwordCheckInput.classList.add("is-valid");
    }
  }

  // 전화번호 실시간 유효성 검사 및 하이픈 추가 기능
  phoneInput.addEventListener('input', function () {
    let phoneValue = phoneInput.value.replace(/[^0-9]/g, ''); // 숫자 이외의 문자는 제거

    if (phoneValue.length > 3 && phoneValue.length <= 7) {
      phoneValue = phoneValue.replace(/(\d{3})(\d{1,4})/, '$1-$2');
    } else if (phoneValue.length > 7) {
      phoneValue = phoneValue.replace(/(\d{3})(\d{4})(\d{1,4})/, '$1-$2-$3');
    }

    phoneInput.value = phoneValue; // 포맷팅된 값을 다시 입력 필드에 넣음

    const phonePattern = /^01[016789]-\d{3,4}-\d{4}$/; // 하이픈 포함된 형식으로 변경
    if (!phonePattern.test(phoneValue)) {
      phoneInput.classList.add("is-invalid");
      phoneInput.classList.remove("is-valid");
    } else {
      phoneInput.classList.remove("is-invalid");
      phoneInput.classList.add("is-valid");
    }
  });

  // Step 2: 개인정보 입력 유효성 검사 함수 (다음 버튼 클릭 시)
  function validateStep2() {
    let isValid = true;
    let errorMessage = "";

    if (!emailInput.classList.contains('is-valid')) {
      isValid = false;
      errorMessage += "올바른 이메일 주소를 입력해주세요.\n";
    }
    if (!passwordInput.classList.contains('is-valid')) {
      isValid = false;
      errorMessage += "올바른 비밀번호를 입력해주세요.\n";
    }
    if (!passwordCheckInput.classList.contains('is-valid')) {
      isValid = false;
      errorMessage += "비밀번호가 일치하지 않습니다.\n";
    }
    if (!phoneInput.classList.contains('is-valid')) {
      isValid = false;
      errorMessage += "올바른 전화번호를 입력해주세요.\n";
    }

    if (!isValid) {
      alert(errorMessage);
    }

    return isValid;
  }
});
  </script>
<footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>